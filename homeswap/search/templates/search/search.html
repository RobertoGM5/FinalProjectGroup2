<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Blog Posts</title>
</head>
<body>
    <h1>Search Blog Posts</h1>
    <form id="searchForm">
        <label for="search_destination">Destination:</label>
        <input type="text" id="search_destination" name="search_destination" required>
        <br>
        <label for="search_start_date">Start Date:</label>
        <input type="date" id="search_start_date" name="search_start_date" required>
        <br>
        <label for="search_end_date">End Date:</label>
        <input type="date" id="search_end_date" name="search_end_date" required>
        <br>
        <label for="search_num_travelers">Number of Travelers:</label>
        <input type="number" id="search_num_travelers" name="search_num_travelers" min="1" required>
        <br>
        <button type="submit">Search</button>
    </form>

    <div id="searchResults"></div>

    <script>
        // JavaScript code for handling search form submission and displaying results
        document.getElementById('searchForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission
            
            // Get form data
            var formData = new FormData(this);

            // Send search request to backend
            fetch('/search/api/search/', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                // Display search results
                var searchResultsDiv = document.getElementById('searchResults');
                searchResultsDiv.innerHTML = ''; // Clear previous search results

                if (data.length > 0) {
                    data.forEach(post => {
                        var resultLink = document.createElement('a');
                        resultLink.href = '/blog/' + post.id + '/'; // URL of the detailed view of the blog post
                        resultLink.target = '_blank'; // Open link in new tab

                        var resultDiv = document.createElement('div');
                        resultDiv.classList.add('search-result'); // Add a CSS class for styling

                        // Include title and other information about the blog post
                        var titleElement = document.createElement('h2');
                        titleElement.textContent = post.title; // Display post title
                        resultDiv.appendChild(titleElement);

                        var locationElement = document.createElement('p');
                        locationElement.textContent = 'Location: ' + post.location; // Display location
                        resultDiv.appendChild(locationElement);

                        var toCityElement = document.createElement('p');
                        toCityElement.textContent = 'To City: ' + post.to_city; // Display to_city
                        resultDiv.appendChild(toCityElement);

                        var maxCapacityElement = document.createElement('p');
                        maxCapacityElement.textContent = 'Max Capacity: ' + post.max_capacity; // Display max_capacity
                        resultDiv.appendChild(maxCapacityElement);

                        var startDateElement = document.createElement('p');
                        startDateElement.textContent = 'Start Date: ' + post.start_date; // Display start date
                        resultDiv.appendChild(startDateElement);

                        var endDateElement = document.createElement('p');
                        endDateElement.textContent = 'End Date: ' + post.end_date; // Display end date
                        resultDiv.appendChild(endDateElement);

                        // Append the result div to the link
                        resultLink.appendChild(resultDiv);

                        // Append the link to the search results container
                        searchResultsDiv.appendChild(resultLink);
                    });
                } else {
                    var noResultsElement = document.createElement('p');
                    noResultsElement.textContent = 'No results found.';
                    searchResultsDiv.appendChild(noResultsElement);
                }
            })
            .catch(error => console.error('Error:', error));
        });
    </script>
</body>
</html>